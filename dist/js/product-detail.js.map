{"version":3,"sources":["webpack:///js/product-detail.js","webpack:///./src/pages/product-detail/index.js","webpack:///./src/pages/product-detail/index.ejs"],"names":["webpackJsonp","41","module","exports","__webpack_require__","42","$","_util","_product","tpl","_cart","productDetail","data","para","productId","orderNum","init","this","load","_this","getUrlQuery","$keyword","$productInfo","getDetail","res","console","log","html","renderHtml","bind","errMsg","stock","$imgList","$mainImg","on","addClass","siblings","removeClass","prop","find","$order","$orderNum","$plusBtn","$minusBtn","Number","text","trim","addToCart","count","cartProductVoList","filter","value","length","saveToLocal","imgPath","imageHost","productMainImage","name","productName","quantity","location","href","alert","mainImage","call","43","44"],"mappings":"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","file":"js/product-detail.js","sourcesContent":["webpackJsonp([4],{\n\n/***/ 41:\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(42);\n\n\n/***/ }),\n\n/***/ 42:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($) {\n\n/*\r\n * @Author: guidetheorient \r\n * @Date: 2018-04-07 13:03:11 \r\n * @Last Modified by: guidetheorient\r\n * @Last Modified time: 2018-04-10 12:32:08\r\n */\n\n// header js&css\n__webpack_require__(4);\n\n// header-search-simple js&css\n__webpack_require__(5);\n\n// simple-footer js&css\n__webpack_require__(2);\n\n// css\n__webpack_require__(43);\n\n// util工具类\nvar _util = __webpack_require__(0);\n// const _needDelay = require('tool/util/menu-need-delay.js');\n\n\nvar _product = __webpack_require__(8);\n\nvar tpl = __webpack_require__(44);\n\nvar _cart = __webpack_require__(7);\n\nvar productDetail = {\n  data: {\n    para: {\n      productId: 0,\n      orderNum: 1\n    }\n  },\n  init: function init() {\n    this.load();\n  },\n  load: function load() {\n    var _this = this;\n    this.data.para.productId = _util.getUrlQuery('productId');\n    this.$keyword = $('.crumb-wrapper .keyword');\n    this.$productInfo = $('.product-intro');\n\n    _product.getDetail({\n      productId: this.data.para.productId\n    }, function (res) {\n      console.log(res);\n      $('.product-detail').html(_util.renderHtml(tpl, res.data));\n\n      _this.bind(res);\n    }, function (errMsg) {\n      $('.product-detail').html(errMsg);\n    });\n  },\n  bind: function bind(res) {\n    this.data.stock = res.stock;\n\n    var _this = this;\n    // hover小图改变预览图\n    var $imgList = $('.img-list');\n    var $mainImg = $('.main-img img');\n    $imgList.on('mouseenter', 'li', function () {\n      $(this).addClass('active').siblings().removeClass('active');\n      $mainImg.prop('src', $(this).find('img').prop('src'));\n    });\n\n    // 加减数量\n    var $order = $('.order-wrapper .order');\n    var $orderNum = $order.find('.order-num');\n    var $plusBtn = $order.find('.plus');\n    var $minusBtn = $order.find('.minus');\n    this.data.para.orderNum = Number($orderNum.text().trim());\n    // 如果数量为1,减的按钮失效\n    if (this.data.para.orderNum === 1) {\n      $minusBtn.addClass('disable');\n    }\n    $minusBtn.on('click', function () {\n      _this.data.para.orderNum -= 1;\n      if (_this.data.para.orderNum < 1) {\n        return;\n      }\n      if (_this.data.para.orderNum === 1) {\n        $minusBtn.addClass('disable');\n      }\n      $orderNum.text(_this.data.para.orderNum);\n    });\n    $plusBtn.on('click', function () {\n      _this.data.para.orderNum += 1;\n      if (_this.data.para.orderNum > 1) {\n        $minusBtn.removeClass('disable');\n      }\n      if (_this.data.para.orderNum > 20) {\n        console.log('此商品每账号最多购买20件');\n        return;\n      }\n      if (_this.data.para.orderNum > _this.data.stock) {\n        console.log('超过库存量');\n        return;\n      }\n      $orderNum.text(_this.data.para.orderNum);\n    });\n\n    // 加入购物车\n    var $addToCartBtn = $('.add-to-cart');\n    $addToCartBtn.on('click', function () {\n      _cart.addToCart({\n        productId: _this.data.para.productId,\n        count: _this.data.para.orderNum\n      }, function (res) {\n        // 接口可能坏了\n        var productDetail = res.data.cartProductVoList.filter(function (value) {\n          return Number(value.productId) === Number(_this.data.para.productId);\n        });\n        if (productDetail.length) {\n          productDetail = productDetail[0];\n        }\n        _util.saveToLocal({\n          imgPath: res.data.imageHost + productDetail.productMainImage,\n          name: productDetail.productName,\n          count: productDetail.quantity,\n          productId: productDetail.productId\n        }, 'order-info');\n\n        location.href = './tip.html?type=add-to-cart';\n      }, function (errMsg) {\n        alert('接口挂了');\n        // 接口坏了，暂时模拟下成功的样式，跳转到tip.html提示页，提示成功加入购物车\n        _util.saveToLocal({\n          imgPath: res.data.imageHost + res.data.mainImage,\n          name: res.data.name,\n          count: _this.data.para.orderNum\n        }, 'order-info');\n        // location.href = './tip.html?type=add-to-cart';\n        // _util.errorTips(errMsg);\n      });\n    });\n  }\n};\n\n$(function () {\n  productDetail.init();\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n\n/***/ 43:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 44:\n/***/ (function(module, exports) {\n\nmodule.exports = \"<ul class=\\\"crumb-wrapper w\\\"> <li class=item>商品详情 <i class=\\\"fa fa-angle-right\\\"></i></li> <li class=item>\\\"<span class=keyword title=\\\"<%= data.name %>\\\"><%= data.name %></span>\\\"</li> </ul> <div class=\\\"product-intro w clearfix\\\"> <div class=preview-wrapper> <div class=main-img> <img src=\\\"<%=data.imageHost + data.mainImage%>\\\" alt=\\\"\\\"> </div> <ul class=img-list> <% data.subImages.split(',').forEach((value,index) => {%> <%if(index === 0) {%> <li class=active> <img data-src=\\\"<%=data.imageHost + value%>\\\" src=\\\"<%=data.imageHost + value%>\\\" alt=\\\"\\\"> </li> <%} else {%> <li> <img data-src=\\\"<%=data.imageHost + value%>\\\" src=\\\"<%=data.imageHost + value%>\\\" alt=\\\"\\\"> </li> <%}%> <%})%> </ul> </div> <div class=info-wrapper> <p class=title><%=data.name%></p> <p class=sub-title><%=data.subtitle%></p> <ul class=summary> <li class=price> <span class=title>京东价</span> <span class=text><i class=\\\"fa fa-jpy\\\"></i><span class=price-num><%=data.price%></span></span> </li> <li class=store> <span class=title>库存</span> <span class=text><span class=store-num><%=data.stock%></span>件</span> </li> <li class=\\\"order-wrapper clearfix\\\"> <div class=order> <p class=order-num>1</p> <div class=plus-minus> <span class=plus>+</span> <span class=minus>-</span> </div> </div> <p class=add-to-cart>加入购物车</p> </li> </ul> </div> </div> <div class=\\\"detail-content w\\\"> <ul class=title> <li>商品介绍</li> </ul> <%-data.detail%> </div>\";\n\n/***/ })\n\n},[41]);\n\n\n// WEBPACK FOOTER //\n// js/product-detail.js","/*\r\n * @Author: guidetheorient \r\n * @Date: 2018-04-07 13:03:11 \r\n * @Last Modified by: guidetheorient\r\n * @Last Modified time: 2018-04-10 12:32:08\r\n */\r\n\r\n\r\n// header js&css\r\nrequire('pages/components/header/index.js');\r\n\r\n// header-search-simple js&css\r\nrequire('pages/components/header-search-simple/index.js');\r\n\r\n// simple-footer js&css\r\nrequire('pages/components/simple-footer/index.js');\r\n\r\n// css\r\nrequire('./index.scss')\r\n\r\n// util工具类\r\nconst _util = require('tool/util/util.js');\r\n// const _needDelay = require('tool/util/menu-need-delay.js');\r\n\r\n\r\nconst _product = require('tool/service/product.js');\r\n\r\nconst tpl = require('./index.ejs');\r\n\r\nconst _cart = require('tool/service/cart.js');\r\n\r\nlet productDetail = {\r\n  data: {\r\n    para: {\r\n      productId: 0,\r\n      orderNum: 1\r\n    }\r\n  },\r\n  init() {\r\n    this.load();\r\n  },\r\n  load() {\r\n    let _this = this;\r\n    this.data.para.productId = _util.getUrlQuery('productId');\r\n    this.$keyword = $('.crumb-wrapper .keyword');\r\n    this.$productInfo = $('.product-intro');\r\n\r\n\r\n    _product.getDetail({\r\n      productId: this.data.para.productId\r\n    }, function (res) {\r\n      console.log(res)\r\n      $('.product-detail').html(_util.renderHtml(tpl, res.data));\r\n\r\n      _this.bind(res);\r\n    }, function (errMsg) {\r\n      $('.product-detail').html(errMsg)\r\n    })\r\n  },\r\n  bind(res) {\r\n    this.data.stock = res.stock;\r\n\r\n    let _this = this;\r\n    // hover小图改变预览图\r\n    let $imgList = $('.img-list');\r\n    let $mainImg = $('.main-img img');\r\n    $imgList.on('mouseenter', 'li', function () {\r\n      $(this).addClass('active').siblings().removeClass('active');\r\n      $mainImg.prop('src', $(this).find('img').prop('src'));\r\n    })\r\n\r\n    // 加减数量\r\n    let $order = $('.order-wrapper .order');\r\n    let $orderNum = $order.find('.order-num');\r\n    let $plusBtn = $order.find('.plus');\r\n    let $minusBtn = $order.find('.minus');\r\n    this.data.para.orderNum = Number($orderNum.text().trim());\r\n    // 如果数量为1,减的按钮失效\r\n    if (this.data.para.orderNum === 1) {\r\n      $minusBtn.addClass('disable')\r\n    }\r\n    $minusBtn.on('click', function () {\r\n      _this.data.para.orderNum -= 1;\r\n      if (_this.data.para.orderNum < 1) {\r\n        return;\r\n      }\r\n      if (_this.data.para.orderNum === 1) {\r\n        $minusBtn.addClass('disable')\r\n      }\r\n      $orderNum.text(_this.data.para.orderNum);\r\n\r\n    })\r\n    $plusBtn.on('click', function () {\r\n      _this.data.para.orderNum += 1;\r\n      if (_this.data.para.orderNum > 1) {\r\n        $minusBtn.removeClass('disable')\r\n      }\r\n      if (_this.data.para.orderNum > 20) {\r\n        console.log('此商品每账号最多购买20件')\r\n        return;\r\n      }\r\n      if (_this.data.para.orderNum > _this.data.stock) {\r\n        console.log('超过库存量')\r\n        return;\r\n      }\r\n      $orderNum.text(_this.data.para.orderNum);\r\n    })\r\n\r\n    // 加入购物车\r\n    let $addToCartBtn = $('.add-to-cart');\r\n    $addToCartBtn.on('click', function () {\r\n      _cart.addToCart({\r\n        productId: _this.data.para.productId,\r\n        count: _this.data.para.orderNum\r\n      },function (res) {\r\n        // 接口可能坏了\r\n        let productDetail = res.data.cartProductVoList.filter(value => {\r\n          return Number(value.productId) === Number(_this.data.para.productId);\r\n        })\r\n        if(productDetail.length) {\r\n          productDetail = productDetail[0]\r\n        }\r\n        _util.saveToLocal({\r\n          imgPath: res.data.imageHost + productDetail.productMainImage,\r\n          name: productDetail.productName,\r\n          count: productDetail.quantity,\r\n          productId: productDetail.productId\r\n        }, 'order-info')\r\n\r\n        location.href = './tip.html?type=add-to-cart';\r\n      },function(errMsg){\r\n        alert('接口挂了')\r\n        // 接口坏了，暂时模拟下成功的样式，跳转到tip.html提示页，提示成功加入购物车\r\n        _util.saveToLocal({\r\n          imgPath: res.data.imageHost + res.data.mainImage,\r\n          name: res.data.name,\r\n          count: _this.data.para.orderNum\r\n        }, 'order-info')\r\n        // location.href = './tip.html?type=add-to-cart';\r\n        // _util.errorTips(errMsg);\r\n      })\r\n    })\r\n  },\r\n\r\n}\r\n\r\n$(function () {\r\n  productDetail.init();\r\n})\n\n\n// WEBPACK FOOTER //\n// ./src/pages/product-detail/index.js","module.exports = \"<ul class=\\\"crumb-wrapper w\\\"> <li class=item>商品详情 <i class=\\\"fa fa-angle-right\\\"></i></li> <li class=item>\\\"<span class=keyword title=\\\"<%= data.name %>\\\"><%= data.name %></span>\\\"</li> </ul> <div class=\\\"product-intro w clearfix\\\"> <div class=preview-wrapper> <div class=main-img> <img src=\\\"<%=data.imageHost + data.mainImage%>\\\" alt=\\\"\\\"> </div> <ul class=img-list> <% data.subImages.split(',').forEach((value,index) => {%> <%if(index === 0) {%> <li class=active> <img data-src=\\\"<%=data.imageHost + value%>\\\" src=\\\"<%=data.imageHost + value%>\\\" alt=\\\"\\\"> </li> <%} else {%> <li> <img data-src=\\\"<%=data.imageHost + value%>\\\" src=\\\"<%=data.imageHost + value%>\\\" alt=\\\"\\\"> </li> <%}%> <%})%> </ul> </div> <div class=info-wrapper> <p class=title><%=data.name%></p> <p class=sub-title><%=data.subtitle%></p> <ul class=summary> <li class=price> <span class=title>京东价</span> <span class=text><i class=\\\"fa fa-jpy\\\"></i><span class=price-num><%=data.price%></span></span> </li> <li class=store> <span class=title>库存</span> <span class=text><span class=store-num><%=data.stock%></span>件</span> </li> <li class=\\\"order-wrapper clearfix\\\"> <div class=order> <p class=order-num>1</p> <div class=plus-minus> <span class=plus>+</span> <span class=minus>-</span> </div> </div> <p class=add-to-cart>加入购物车</p> </li> </ul> </div> </div> <div class=\\\"detail-content w\\\"> <ul class=title> <li>商品介绍</li> </ul> <%-data.detail%> </div>\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/product-detail/index.ejs\n// module id = 44\n// module chunks = 4"],"sourceRoot":""}